<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>å®å¨å²å­è¡¨æ ¼å° GitHub</title>
  <style>
    table { border-collapse: collapse; margin-bottom: 1em; }
    td { border: 1px solid #999; padding: 2px; }
    input { width: 100px; border: none; padding: 5px; }
    textarea { width: 100%; height: 300px; font-family: monospace; }
  </style>
</head>
<body>
  <h2>è¼¸å¥è³æè¡¨æ ¼ï¼10Ã29ï¼</h2>
  <table id="inputTable"><tbody></tbody></table>

  <button onclick="exportTable()">ð é è¦½è¡¨æ ¼ç¢¼</button>
  <button onclick="saveToGitHub()">ð¾ å²å­å° GitHub</button>

  <h3>è¼¸åº HTML è¡¨æ ¼ç¢¼</h3>
  <textarea id="outputArea" readonly></textarea>

  <script>
    const rows = 10, cols = 29;
    const tbody = document.getElementById('inputTable').querySelector('tbody');

    for (let r = 0; r < rows; r++) {
      const tr = document.createElement('tr');
      for (let c = 0; c < cols; c++) {
        const td = document.createElement('td');
        const input = document.createElement('input');
        input.type = 'text';
        td.appendChild(input);
        tr.appendChild(td);
      }
      tbody.appendChild(tr);
    }

    function exportTable() {
      const table = document.createElement('table');
      table.border = 1;
      [...tbody.rows].forEach(tr => {
        const newTr = document.createElement('tr');
        [...tr.cells].forEach(td => {
          const val = td.querySelector('input').value.trim();
          const newTd = document.createElement('td');
          newTd.textContent = val;
          newTr.appendChild(newTd);
        });
        table.appendChild(newTr);
      });
      document.getElementById('outputArea').value = table.outerHTML;
      return table.outerHTML;
    }

    async function saveToGitHub() {
      const token = prompt("è«è¼¸å¥ä½ ç GitHub Tokenï¼ä¸æå²å­ï¼ï¼");
      if (!token) return alert("â æªè¼¸å¥éé°");

      const settings = {
        owner: "menghushao",
        repo: "Order-management",
        branch: "main",
        path: "index.html"
      };

      const tableHTML = exportTable();
      const apiURL = `https://api.github.com/repos/${settings.owner}/${settings.repo}/contents/${settings.path}`;

      try {
        const getResp = await fetch(`${apiURL}?ref=${settings.branch}`, {
          headers: {
            Authorization: `Bearer ${token}`,
            Accept: 'application/vnd.github+json'
          }
        });
        const getData = await getResp.json();
        const sha = getData.sha;
        const originHTML = atob(getData.content.replace(/\n/g, ''));

        const replaced = originHTML.replace(
          /<!-- START-TABLE -->
<table border="1"><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td>這個屌</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></table>
<!-- END-TABLE -->/,
          `<!-- START-TABLE -->\n${tableHTML}\n<!-- END-TABLE -->`
        );

        const payload = {
          message: "å®å¨æ´æ°è¡¨æ ¼",
          content: btoa(unescape(encodeURIComponent(replaced))),
          sha,
          branch: settings.branch
        };

        const putResp = await fetch(apiURL, {
          method: "PUT",
          headers: {
            Authorization: `Bearer ${token}`,
            Accept: 'application/vnd.github+json',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(payload)
        });

        const result = await putResp.json();
        if (result.content) {
          alert("â è¡¨æ ¼å·²å®å¨æ´æ°ä¸ GitHubï¼");
        } else {
          alert("â å²å­å¤±æï¼" + (result.message || "è«æ¥ç console"));
        }
      } catch (err) {
        alert("ð« å·è¡é¯èª¤ï¼è«é console æ¥çç´°ç¯");
        console.error(err);
      }
    }
  </script>
</body>
</html>
